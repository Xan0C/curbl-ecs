<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="This is just a test document for Benchmark.js.">
    <title>Benchmark.js test page | jsPerf</title>
    <!-- https://jsperf.com/benchmark-js-test-page -->
    <meta name="referrer" content="never">
    <meta name="robots" content="noindex">
    <script>document.documentElement.className = 'js'</script>
</head>
<body>
<article>
    <hgroup>
        <h1>@curbls/ecs Benchmark</h1>
    </hgroup>

    <section id="runner">
        <h2>Test runner</h2>
        <div id="controls">
            <button id="run" type="button">Start Test</button>
        </div>
        <table id="test-table">
            <caption>Testing in <span id="user-agent"></span></caption>
            <thead>
            <tr>
                <th colspan="2">Test</th>
                <th title="Operations per second (higher is better)">Ops/sec</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th scope="row" id="title-1">
                    <div>Normal</div>
                </th>
                <td class="code">
              <pre><code>x.<span class="me1">sort</span><span class="br0">&#40;</span><span
                      class="kw2">function</span><span class="br0">&#40;</span>a<span
                      class="sy0">,</span> b<span class="br0">&#41;</span> <span
                      class="br0">&#123;</span><br>&nbsp; <span class="kw1">return</span> a <span
                      class="sy0">-</span> b<span class="sy0">;</span><br><span
                      class="br0">&#125;</span><span class="br0">&#41;</span><span
                      class="sy0">;</span></code></pre>
                </td>
                <td id="results-1" class="results"></td>
            </tr>
            <tr>
                <th scope="row" id="title-2">
                    <div>Exit Early</div>
                </th>
                <td class="code">
              <pre><code>x.<span class="me1">sort</span><span class="br0">&#40;</span><span
                      class="kw2">function</span><span class="br0">&#40;</span>a<span
                      class="sy0">,</span> b<span class="br0">&#41;</span> <span
                      class="br0">&#123;</span><br>&nbsp; <span class="kw1">return</span> a <span
                      class="sy0">-</span> b<span class="sy0">;</span><br><span
                      class="br0">&#125;</span><span class="br0">&#41;</span><span
                      class="sy0">;</span><br><span class="kw1">return</span><span
                      class="sy0">;</span></code></pre>
                </td>
                <td id="results-2" class="results"></td>
            </tr>
            <tr>
                <th scope="row" id="title-3">
                    <div>Async</div>
                </th>
                <td class="code">
              <pre><code><strong class="co1">// async test</strong><br>setTimeout<span
                      class="br0">&#40;</span><span class="kw2">function</span><span
                      class="br0">&#40;</span><span class="br0">&#41;</span> <span
                      class="br0">&#123;</span><br>&nbsp; deferred.<span
                      class="me1">resolve</span><span class="br0">&#40;</span><span
                      class="br0">&#41;</span><span class="sy0">;</span><br><span
                      class="br0">&#125;</span><span class="sy0">,</span> <span
                      class="nu0">10</span><span class="br0">&#41;</span><span
                      class="sy0">;</span></code></pre>
                </td>
                <td id="results-3" class="results"></td>
            </tr>
            <tr>
                <th scope="row" id="title-4">
                    <div>Error</div>
                </th>
                <td class="code">
              <pre><code>x.<span class="me1">foo</span><span class="br0">&#40;</span><span
                      class="br0">&#41;</span><span class="sy0">;</span> <span
                      class="co1">// unknown method</span></code></pre>
                </td>
                <td id="results-4" class="results"></td>
            </tr>
            <tr>
                <th scope="row" id="title-5">
                    <div>Comments</div>
                </th>
                <td class="code">
              <pre><code><span class="co1">// comments at start</span><br>x.<span
                      class="me1">reverse</span><span class="br0">&#40;</span><span
                      class="br0">&#41;</span>.<span class="me1">sort</span><span
                      class="br0">&#40;</span><span class="kw2">function</span><span
                      class="br0">&#40;</span>a<span class="sy0">,</span> b<span
                      class="br0">&#41;</span> <span class="br0">&#123;</span><br>&nbsp; <span
                      class="kw1">return</span> a <span class="sy0">-</span> b<span
                      class="sy0">;</span><br><span class="br0">&#125;</span><span
                      class="br0">&#41;</span><span class="sy0">;</span><br><span
                      class="co1">// comments at end</span></code></pre>
                </td>
                <td id="results-5" class="results"></td>
            </tr>
            </tbody>
        </table>

        <p>
            You can <a href="#" rel="nofollow">edit these tests or add even more tests to this page</a>
            by appending <code>/edit</code> to the URL.
        </p>
    </section>

    <section>
        <h2 id="results">Compare results of other browsers</h2>
        <div id="bs-results"></div>
    </section>

    <section id="comments">
        <h1>0 comments</h1>
        <div id="comments-wrapper">
            <form action="#comment-form" method="post" id="comment-form">
                <fieldset>
                    <h2>Add a comment</h2>
                    <div>
                        <label for="author">Name <em title="This field is required">*</em></label>
                        <input type="text" name="author" id="author" required>
                    </div>
                    <div>
                        <label for="author-email">Email <em title="This field is required">*</em></label>
                        <label class="inline">
                            <input type="email" name="author-email" id="author-email" required> (only used for Gravatar)
                        </label>
                    </div>
                    <div>
                        <label for="author-url">URL </label>
                        <input type="url" name="author-url" id="author-url">
                    </div>
                    <div>
                        <label for="message">Message <em title="This field is required">*</em><span>Markdown syntax is allowed</span></label>
                        <textarea name="message" id="message" required></textarea>
                    </div>
                    <div class="buttons">
                        <input type="submit" class="submit" value="Add comment">
                    </div>
                </fieldset>
            </form>
        </div>
    </section>
</article>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/platform/1.3.6/platform.min.js" integrity="sha512-eYPrm8TgYWg3aa6tvSRZjN4v0Z9Qx69q3RhfSj+Mf89QqwOMqmwSlsVqfp4N8NVAcZe/YeUhh9x/nM2CAOp6cA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/benchmark/2.1.4/benchmark.min.js" integrity="sha512-xQc9DgKsysVXOYCdYCygJIizr64rtYYmNcOv4iKCBJw/xvuiaeG7FIwrkXuCgJg4U7oTqqNpknbC6eyc0NSREg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="./dist/main.js"></script>
<script type="module">
    const suite = new Benchmark.Suite();

    class PositionComponent {
        x = 0;
        y = 0;
    }
    ECS.Component('Position')(PositionComponent)
    new PositionComponent();

    class PositionSystem {
        setUp() {}

        tearDown() {}

        onEntityAdded(entity) {
            entity;
        }
        onEntityRemoved(entity) {
            entity;
        }

        entities() {
            return this.constructor.__entities;
        }

        update() {
            const entities = this.entities();
            for (let i = 0, entity; (entity = entities[i]); i++) {
                entity;
            }
        }
    }
    ECS.System('Position')(PositionSystem)
    const entities = [];
    ECS.addSystem(new PositionSystem());

    for (let i = 0; i < 100_000; i++) {
        const entity = ECS.createEntity();
        entity.add(new PositionComponent());
        entities.push(entity);
    }
    ECS.update();

    // Note(SÃ¶ren): goal is minimum of 150 ops/s which to be fair is way to slow
    suite
        .add('ECS#update_100k_entities_1System_1Components_no_change', function () {
            ECS.update();
        })
        .add('ECS#add_and_remove_entities_1k_1Component', function () {
            for (let i = 0; i < 1000; i++) {
                entities[i].dispose();
                const entity = ECS.createEntity(new PositionComponent());
                entities.push(entity);
            }
            ECS.update();
        })
        .add('ECS#add_modify_1k_Entities', function () {
            for (let i = 0; i < 1000; i++) {
                if (i % 2 === 0) {
                    entities[i].remove('Position');
                } else {
                    entities[i].add(new PositionComponent());
                }
            }
            ECS.update();
        })
        .on('cycle', function (event) {
            console.log(String(event.target));
        })
        .run({ async: true });
</script>
</body>
</html>